# Mock API Server - TDD 開發規劃清單

## 📋 開發方法論
- **TDD 循環**: 紅燈 → 綠燈 → 重構
- **測試優先**: 每個功能都先寫測試
- **小步迭代**: 每次只實作一個小功能
- **持續重構**: 保持代碼品質和可讀性

## 🎯 第一階段 - MVP 核心功能

### 📦 專案初始化
- [x] 建立 PRD 文件
- [x] 建立規劃清單
- [x] 初始化 Node.js 專案
- [x] 設定 TypeScript 配置
- [x] 設定測試框架 (Jest)
- [x] 設定 ESLint 和 Prettier
- [x] 建立基本專案結構
- [x] 設定 package.json scripts

### 🏗️ 核心架構設計
- [x] 設計配置檔案結構 (ConfigSchema)
- [x] 設計 API 端點模型 (ApiEndpoint)
- [x] 設計回應模型 (ApiResponse)
- [x] 設計伺服器核心類別 (MockServer)
- [x] 設計路由管理器 (RouteManager)

### 📝 配置管理模組
- [x] **ConfigLoader** - 載入 YAML/JSON 配置檔案
  - [x] 測試: 載入有效的 YAML 配置
  - [x] 測試: 載入有效的 JSON 配置
  - [x] 測試: 處理無效配置檔案
  - [x] 測試: 處理檔案不存在的情況
  - [x] 實作: ConfigLoader 類別
  - [x] 重構: 優化錯誤處理

- [x] **ConfigValidator** - 驗證配置檔案格式
  - [x] 測試: 驗證必要欄位存在
  - [x] 測試: 驗證 HTTP 方法有效性
  - [x] 測試: 驗證路徑格式
  - [x] 測試: 驗證回應格式
  - [x] 實作: ConfigValidator 類別
  - [x] 重構: 提取驗證規則

- [ ] **ConfigWatcher** - 監控配置檔案變更
  - [ ] 測試: 檔案變更時觸發重載
  - [ ] 測試: 無效變更時保持原配置
  - [ ] 實作: 檔案監控機制
  - [ ] 重構: 優化監控效能

### 🌐 HTTP 伺服器模組
- [x] **MockServer** - 核心伺服器類別
  - [x] 測試: 伺服器啟動和關閉
  - [x] 測試: 設定伺服器埠號
  - [x] 測試: 設定 CORS 支援
  - [x] 實作: 基本 Express 伺服器
  - [x] 重構: 抽象化伺服器配置

- [x] **RouteManager** - 路由管理
  - [x] 測試: 註冊 GET 路由
  - [x] 測試: 註冊 POST 路由
  - [x] 測試: 註冊帶參數的路由
  - [x] 測試: 路由衝突處理
  - [x] 實作: 動態路由註冊
  - [x] 重構: 優化路由匹配演算法

### 📤 回應處理模組
- [ ] **ResponseGenerator** - 回應生成器
  - [ ] 測試: 生成 JSON 回應
  - [ ] 測試: 生成自訂狀態碼回應
  - [ ] 測試: 生成帶標頭的回應
  - [ ] 測試: 處理動態內容
  - [ ] 實作: 基本回應生成
  - [ ] 重構: 支援多種回應格式

- [x] **TemplateEngine** - 動態內容引擎
  - [x] 測試: 替換路徑參數 {{params.id}}
  - [x] 測試: 替換查詢參數 {{query.name}}
  - [x] 測試: 替換請求主體 {{body.field}}
  - [x] 測試: 生成隨機數據 {{random.number}}
  - [x] 實作: 模板解析引擎
  - [x] 重構: 擴展模板函數

### 🔍 基本 HTTP 方法支援
- [ ] **GET 請求處理**
  - [ ] 測試: 簡單 GET 請求
  - [ ] 測試: 帶查詢參數的 GET 請求
  - [ ] 測試: 帶路徑參數的 GET 請求
  - [ ] 實作: GET 請求處理器
  - [ ] 重構: 統一參數處理

- [ ] **POST 請求處理**
  - [ ] 測試: JSON 主體解析
  - [ ] 測試: 表單數據解析
  - [ ] 測試: 檔案上傳處理
  - [ ] 實作: POST 請求處理器
  - [ ] 重構: 主體解析器抽象化

- [ ] **PUT/DELETE 請求處理**
  - [ ] 測試: PUT 請求處理
  - [ ] 測試: DELETE 請求處理
  - [ ] 測試: PATCH 請求處理
  - [ ] 實作: 其他 HTTP 方法
  - [ ] 重構: 統一請求處理流程

### 🚀 命令列介面
- [ ] **CLI 工具**
  - [ ] 測試: 解析命令列參數
  - [ ] 測試: 顯示幫助訊息
  - [ ] 測試: 啟動伺服器命令
  - [ ] 實作: 基本 CLI 功能
  - [ ] 重構: 改善使用者體驗

## 🎯 第二階段 - 進階功能

### 🎛️ 進階回應控制
- [ ] **條件式回應**
  - [ ] 測試: 基於請求參數的條件
  - [ ] 測試: 基於請求標頭的條件
  - [ ] 測試: 複合條件邏輯
  - [ ] 實作: 條件評估引擎
  - [ ] 重構: 條件表達式優化

- [ ] **延遲模擬**
  - [ ] 測試: 固定延遲時間
  - [ ] 測試: 隨機延遲範圍
  - [ ] 實作: 非阻塞延遲機制
  - [ ] 重構: 延遲策略抽象化

- [ ] **機率式回應**
  - [ ] 測試: 基於機率選擇回應
  - [ ] 測試: 多個回應的機率分配
  - [ ] 實作: 機率選擇演算法
  - [ ] 重構: 隨機數生成器

### 📊 監控與日誌
- [ ] **請求日誌**
  - [ ] 測試: 記錄請求詳情
  - [ ] 測試: 日誌格式化
  - [ ] 測試: 日誌輪轉
  - [ ] 實作: 日誌記錄系統
  - [ ] 重構: 可配置日誌級別

- [ ] **效能監控**
  - [ ] 測試: 回應時間統計
  - [ ] 測試: 請求計數統計
  - [ ] 測試: 記憶體使用監控
  - [ ] 實作: 指標收集系統
  - [ ] 重構: 指標存儲優化

### 🌐 Web UI 管理介面
- [ ] **API 管理頁面**
  - [ ] 測試: 顯示 API 清單
  - [ ] 測試: 新增/編輯 API
  - [ ] 測試: 刪除 API
  - [ ] 實作: 基本 Web 介面
  - [ ] 重構: 響應式設計

- [ ] **即時監控頁面**
  - [ ] 測試: 即時請求顯示
  - [ ] 測試: WebSocket 連接
  - [ ] 實作: 即時數據推送
  - [ ] 重構: 前端狀態管理

## 🎯 第三階段 - 企業級功能

### 🔐 認證與安全
- [ ] **基本認證模擬**
  - [ ] 測試: Basic Auth 驗證
  - [ ] 測試: Bearer Token 驗證
  - [ ] 實作: 認證中間件
  - [ ] 重構: 認證策略模式

- [ ] **JWT 模擬**
  - [ ] 測試: JWT 生成
  - [ ] 測試: JWT 驗證
  - [ ] 實作: JWT 處理器
  - [ ] 重構: Token 管理

### 🔌 擴展性功能
- [ ] **插件系統**
  - [ ] 測試: 插件載入機制
  - [ ] 測試: 插件生命週期
  - [ ] 實作: 插件架構
  - [ ] 重構: 插件 API 設計

- [ ] **中間件支援**
  - [ ] 測試: 自訂中間件註冊
  - [ ] 測試: 中間件執行順序
  - [ ] 實作: 中間件管道
  - [ ] 重構: 中間件組合

### 📦 部署與整合
- [ ] **Docker 支援**
  - [ ] 測試: Docker 映像建構
  - [ ] 測試: 容器啟動
  - [ ] 實作: Dockerfile
  - [ ] 重構: 多階段建構

- [ ] **OpenAPI 整合**
  - [ ] 測試: OpenAPI 規格解析
  - [ ] 測試: Swagger UI 整合
  - [ ] 實作: 規格轉換器
  - [ ] 重構: 規格驗證

## 📈 持續改進

### 🧪 測試覆蓋率
- [ ] 單元測試覆蓋率 > 90%
- [ ] 整合測試覆蓋率 > 80%
- [ ] E2E 測試覆蓋率 > 70%

### 📚 文件完善
- [ ] API 文件
- [ ] 使用者指南
- [ ] 開發者文件
- [ ] 部署指南

### 🚀 效能優化
- [ ] 記憶體使用優化
- [ ] 回應時間優化
- [ ] 並發處理優化
- [ ] 啟動時間優化

## 📝 開發筆記

### 當前進度
- **階段**: 第一階段 MVP - 核心功能完成 80%
- **當前任務**: 完善基本 HTTP 方法支援
- **下一步**: 實作進階回應控制功能
- **已完成模組**: ConfigLoader, ConfigValidator, MockServer, RouteManager, TemplateEngine

### TDD 循環記錄
```
循環 1: 2024-12-19 - ConfigLoader 基本功能
🔴 紅燈: 寫測試 - 建立 ConfigLoader 測試，包含 YAML/JSON 載入、錯誤處理
🟢 綠燈: 實作 - 實作基本 ConfigLoader 類別，通過所有測試
🔵 重構: 改進 - 拆分方法、改善錯誤處理、增加文件註解

循環 2: 2024-12-19 - ConfigValidator 配置驗證
🔴 紅燈: 寫測試 - 建立 ConfigValidator 測試，涵蓋各種驗證情境
🟢 綠燈: 實作 - 實作完整的配置驗證邏輯，包含伺服器和 API 驗證
🔵 重構: 改進 - 整合 ConfigValidator 到 ConfigLoader，統一錯誤處理

循環 3: 2024-12-19 - MockServer 核心伺服器
🔴 紅燈: 寫測試 - 建立 MockServer、RouteManager、TemplateEngine 測試
🟢 綠燈: 實作 - 實作完整的 HTTP 伺服器，支援動態路由和模板引擎
🔵 重構: 改進 - 優化中間件設置、錯誤處理和模板處理邏輯

循環 4: [進行中] - 基本 HTTP 方法支援
🔴 紅燈: 
🟢 綠燈: 
🔵 重構: 
```

### 技術決策
- **語言**: TypeScript (型別安全)
- **框架**: Express.js (成熟穩定)
- **測試**: Jest + Supertest (完整測試生態)
- **配置**: YAML (可讀性佳)
- **日誌**: Winston (功能豐富)

### 程式碼品質指標
- [ ] ESLint 無警告
- [ ] Prettier 格式化
- [ ] TypeScript 嚴格模式
- [ ] 100% 測試通過
- [ ] 覆蓋率達標

---

**最後更新**: 2024年12月  
**當前版本**: v0.1.0  
**開發狀態**: 🚧 進行中